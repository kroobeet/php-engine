server {
    # Заголовки безопасности
    add_header X-Content-Type-Options nosniff; # Запрет на определение типа контента
    add_header X-Frame-Options DENY; # Запрет на встраивание в фреймы
    add_header X-XSS-Protection "1; mode=block"; # Защита от XSS-атак
    add_header Content-Security-Policy "default-src 'self';"; # Политика безопасности контента

    listen 80; # Слушаем на порту 80
    server_name localhost; # Имя сервера

    root /var/www/html/public; # Корневой каталог
    index index.php; # Индексные файлы

    # Основной блок для обработки запросов
    location / {
        try_files $uri $uri/ /index.php?$query_string; # Попытка найти файл или каталог
    }

    # Обработка PHP файлов
    location ~ \.php$ {
        fastcgi_pass app:9000; # Прокси на PHP-FPM
        fastcgi_index index.php; # Индексный файл для PHP
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; # Параметры для PHP
        include fastcgi_params; # Подключение параметров FastCGI
    }

    # Запрет доступа к .htaccess и подобным файлам
    location ~ /\.ht {
        deny all; # Запретить доступ
    }

    # Доступ к ресурсам
    location /resources/ {
        alias /var/www/html/resources/; # Путь к ресурсам
    }

    # Ограничение методов запросов
    if ($request_method !~ ^(GET|POST)$) {
        return 444; # Закрыть соединение для других методов
    }

    # Запрет доступа к чувствительным файлам
    location ~* \.(env|git|svn|htaccess)$ {
        deny all; # Запретить доступ
    }

    # Запрет выполнения PHP в каталоге uploads
    location /uploads/ {
        location ~ \.php$ {
            deny all; # Запретить выполнение
        }
    }
}
